os: linux
services: docker
language: minimal
install: skip
addons:
  apt:
    packages:
      - pass

stages:
  - test
  - ext

jobs:
  include:
    - &job
      env: IMAGE=debian
      script: ./travis/run.sh -l $IMAGE
      deploy:
        - provider: script
          skip_cleanup: true
          script: ./travis/run.sh "$IMAGE"
          on:
            repo: ghdl/docker
            branch: ext
    - <<: *job
      env: IMAGE=ubuntu
    - <<: *job
      env: IMAGE=synth
      script: ./travis/run.sh -e
    - <<: *job
      env: IMAGE=pnr
      script: ./travis/run.sh -e
    - <<: *job
      stage: ext
      env: IMAGE=ext
      script: ./travis/run.sh -e
    - <<: *job
      stage: ext
      env: IMAGE=formal
      script: ./travis/run.sh -e
