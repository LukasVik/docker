ARG IMAGE="python:rc-slim-buster"

#---

FROM $IMAGE AS base

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    ca-certificates \
    curl \
    gcc \
    make \
    zlib1g-dev \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove \
 && update-ca-certificates \
 && pip3 install setuptools wheel

#---

FROM base AS build

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    clang-7 \
    gnat-7 \
    llvm-7-dev \
    npm \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove \
 && npm install -g vsce

#---

FROM base AS run

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    libgnat-7 \
    libllvm7 \
    unzip \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove
