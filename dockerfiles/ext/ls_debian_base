ARG IMAGE="python:slim-stretch"


#---


FROM $IMAGE AS base

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    ca-certificates \
    curl \
    gcc \
    make \
    zlib1g-dev \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove \
 && update-ca-certificates \
 && pip3 install setuptools wheel


#---


FROM base AS build

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    clang-4.0 \
    gnat \
    llvm-4.0-dev \
 && curl -sL https://deb.nodesource.com/setup_10.x | bash - \
 && apt update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    npm \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove \
 && npm install -g vsce


#---


FROM base AS run

RUN apt-get update -qq \
 && DEBIAN_FRONTEND=noninteractive apt-get -y install --no-install-recommends \
    libgnat-6 \
    libllvm4.0 \
    unzip \
 && apt-get autoclean && apt-get clean && apt-get -y autoremove
